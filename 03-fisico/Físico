/* Logico_imobiliaria: */
CREATE TABLE Proprietario (
    id_proprietario INTEGER PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    cpf_cnpj VARCHAR(20) UNIQUE,
    telefone VARCHAR(30),
    email VARCHAR(100)
);

CREATE TABLE Empreendimento (
    id_empreendimento INTEGER PRIMARY KEY,
    nome VARCHAR(150) NOT NULL,
    construtora VARCHAR(150),
    endereco VARCHAR(200),
    status VARCHAR(30)
);

CREATE TABLE Imovel (
    id_imovel INTEGER PRIMARY KEY,
    tipo_imovel VARCHAR(50),
    descricao TEXT,
    endereco VARCHAR(200),
    area_m2 NUMERIC,
    valor NUMERIC,
    status VARCHAR(30),
    id_proprietario INTEGER,
    id_empreendimento INTEGER,
    CONSTRAINT FK_Imovel_Proprietario FOREIGN KEY (id_proprietario)
        REFERENCES Proprietario(id_proprietario)
        ON DELETE SET NULL,
    CONSTRAINT FK_Imovel_Empreendimento FOREIGN KEY (id_empreendimento)
        REFERENCES Empreendimento(id_empreendimento)
        ON DELETE SET NULL
);

CREATE TABLE Cliente (
    id_cliente INTEGER PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    cpf VARCHAR(14) UNIQUE,
    telefone VARCHAR(30),
    email VARCHAR(100),
    tipo_cliente VARCHAR(30) -- ex: comprador, locatario
);

CREATE TABLE Corretor (
    id_corretor INTEGER PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    creci VARCHAR(30) UNIQUE,
    telefone VARCHAR(30),
    email VARCHAR(100),
    status VARCHAR(30)
);

CREATE TABLE Visita (
    id_visita INTEGER PRIMARY KEY,
    data_visita DATE NOT NULL,
    horario TIME,
    observacoes TEXT,
    id_cliente INTEGER NOT NULL,
    id_corretor INTEGER NOT NULL,
    id_imovel INTEGER NOT NULL,
    CONSTRAINT FK_Visita_Cliente FOREIGN KEY (id_cliente)
        REFERENCES Cliente(id_cliente)
        ON DELETE RESTRICT,
    CONSTRAINT FK_Visita_Corretor FOREIGN KEY (id_corretor)
        REFERENCES Corretor(id_corretor)
        ON DELETE RESTRICT,
    CONSTRAINT FK_Visita_Imovel FOREIGN KEY (id_imovel)
        REFERENCES Imovel(id_imovel)
        ON DELETE RESTRICT
);

CREATE TABLE Contrato (
    id_contrato INTEGER PRIMARY KEY,
    tipo_contrato VARCHAR(20) NOT NULL, -- ex: venda, locacao
    data_inicio DATE NOT NULL,
    data_fim DATE,
    valor_final DECIMAL(14,2),
    id_cliente INTEGER NOT NULL,
    id_corretor INTEGER NOT NULL,
    id_imovel INTEGER NOT NULL,
    CONSTRAINT FK_Contrato_Cliente FOREIGN KEY (id_cliente)
        REFERENCES Cliente(id_cliente)
        ON DELETE RESTRICT,
    CONSTRAINT FK_Contrato_Corretor FOREIGN KEY (id_corretor)
        REFERENCES Corretor(id_corretor)
        ON DELETE RESTRICT,
    CONSTRAINT FK_Contrato_Imovel FOREIGN KEY (id_imovel)
        REFERENCES Imovel(id_imovel)
        ON DELETE RESTRICT
);

CREATE INDEX IDX_Imovel_status ON Imovel(status);
CREATE INDEX IDX_Cliente_cpf ON Cliente(cpf);
CREATE INDEX IDX_Contrato_data_inicio ON Contrato(data_inicio);
CREATE INDEX IDX_Visita_data ON Visita(data_visita);